"use strict";
/**
* @author Bazzite (https://www.bazzite.com)
* @license MIT License Copyright (c) 2018 Bazzite
*/
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var data_service_1 = require("../shared/data.service");
var core_10_0_2_1 = require("../@ngx-translate/core@10.0.2");
var router_1 = require("@angular/router");
var router_2 = require("nativescript-angular/router");
var confirmation_service_1 = require("./confirmation.service");
var nativescript_secure_storage_1 = require("nativescript-secure-storage");
var platformModule = require("tns-core-modules/platform");
var ConfirmationComponent = /** @class */ (function () {
    function ConfirmationComponent(translate, routerExtensions, acRoute, myPostService) {
        var _this = this;
        this.translate = translate;
        this.routerExtensions = routerExtensions;
        this.acRoute = acRoute;
        this.myPostService = myPostService;
        this.transactions = [];
        this.expensesChartDataEn = [];
        this.expensesChartDataEs = [];
        this.currentLanguage = 'en';
        this.country = [];
        // public number=""
        this.cc = "";
        this.input = "";
        this.verifyText = "Please Verify the number +";
        this.data = new data_service_1.DataService();
        this.transactions = this.data.getTransactions();
        this.expensesChartDataEn = [
            { name: "Home", ammount: 90 },
            { name: "Auto & Transport", ammount: 76 },
            { name: "Communication", ammount: 60 },
            { name: "Hotel", ammount: 44 }
        ];
        this.expensesChartDataEs = [
            { name: "Hogar", ammount: 20 },
            { name: "Transporte", ammount: 76 },
            { name: "Comunicaci√≥n", ammount: 60 },
            { name: "Hotel", ammount: 44 }
        ];
        translate.onLangChange.subscribe(function (event) {
            _this.currentLanguage = event.lang;
        });
    }
    ConfirmationComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.acRoute.queryParams.subscribe(function (params) {
            if (params["number"]) {
                _this.verifyText = _this.verifyText + String(params["cc"]) + String(params["number"]);
                _this.number = params['number'];
                _this.cc = params['cc'];
            }
        });
    };
    ConfirmationComponent.prototype.onTap = function (e) {
        var _this = this;
        var cc = String(this.cc);
        var pn = String(this.number);
        var udid = platformModule.device.uuid;
        //900C6D4737B9F7D5
        var data = "udid=" + udid + "&cc=" + cc + "&os=IOS&app_id=1&pn=" + pn + "&code=" + String(this.input);
        console.log(data);
        this.myPostService
            .postData(data)
            .subscribe(function (res) {
            //  this.message = (<any>res).json.data.username;
            console.log(res);
            var code = res.code;
            if (code == 204) {
                var secureStorage = new nativescript_secure_storage_1.SecureStorage();
                var value = secureStorage.getSync({
                    key: "sip_user"
                });
                if (!value) {
                    var data_1 = res.data;
                    secureStorage.set({
                        key: "sip_user",
                        value: data_1.user
                    }).then(function (success) { return console.log("Saved User" + success); });
                    secureStorage.set({
                        key: "sip_password",
                        value: data_1.password
                    }).then(function (success) { return console.log("Saved password" + success); });
                    secureStorage.set({
                        key: "sip_proxy",
                        value: data_1.proxy
                    }).then(function (success) { return console.log("Saved proxy" + success); });
                    secureStorage.set({
                        key: "sip_transport",
                        value: data_1.transport
                    }).then(function (success) { return console.log("Saved transport" + success); });
                    secureStorage.set({
                        key: "sip_port",
                        value: data_1.port
                    }).then(function (success) { return console.log("Saved password" + success); });
                    _this.routerExtensions.navigate(['home'], {
                        transition: {
                            name: "fade"
                        },
                        queryParams: {
                            number: String(_this.number),
                            cc: String(_this.countryCode)
                        },
                        clearHistory: true
                    });
                }
                else {
                    _this.routerExtensions.navigate(['home'], {
                        transition: {
                            name: "fade"
                        },
                        queryParams: {
                            number: String(_this.number),
                            cc: String(_this.countryCode)
                        },
                        clearHistory: true
                    });
                }
            }
            else {
                alert("error: " + code + " " + res.error);
            }
        });
    };
    ConfirmationComponent = __decorate([
        core_1.Component({
            selector: "Confirmation",
            moduleId: module.id,
            templateUrl: "./confirmation.component.html",
            providers: [confirmation_service_1.MyregisterPostService]
        }),
        __metadata("design:paramtypes", [core_10_0_2_1.TranslateService, router_2.RouterExtensions,
            router_1.ActivatedRoute, confirmation_service_1.MyregisterPostService])
    ], ConfirmationComponent);
    return ConfirmationComponent;
}());
exports.ConfirmationComponent = ConfirmationComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlybWF0aW9uLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNvbmZpcm1hdGlvbi5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7RUFHRTs7QUFFRixzQ0FBa0Q7QUFFbEQsdURBQXFEO0FBQ3JELDZEQUFrRjtBQUVsRiwwQ0FBZ0Y7QUFDaEYsc0RBQStEO0FBQy9ELCtEQUErRDtBQUUvRCwyRUFBNEQ7QUFDNUQsMERBQTREO0FBTzVEO0lBYUksK0JBQW9CLFNBQTJCLEVBQVUsZ0JBQWtDLEVBQ2xGLE9BQXNCLEVBQVMsYUFBb0M7UUFENUUsaUJBd0JDO1FBeEJtQixjQUFTLEdBQVQsU0FBUyxDQUFrQjtRQUFVLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFDbEYsWUFBTyxHQUFQLE9BQU8sQ0FBZTtRQUFTLGtCQUFhLEdBQWIsYUFBYSxDQUF1QjtRQVY1RSxpQkFBWSxHQUFHLEVBQUUsQ0FBQTtRQUNqQix3QkFBbUIsR0FBRyxFQUFFLENBQUM7UUFDekIsd0JBQW1CLEdBQUcsRUFBRSxDQUFDO1FBSWxCLG9CQUFlLEdBQUcsSUFBSSxDQUFDO1FBNEJ2QixZQUFPLEdBQU8sRUFBRSxDQUFBO1FBQ3hCLG1CQUFtQjtRQUNYLE9BQUUsR0FBQyxFQUFFLENBQUM7UUFDTixVQUFLLEdBQUMsRUFBRSxDQUFDO1FBQ1QsZUFBVSxHQUFDLDRCQUE0QixDQUFBO1FBM0IxQyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksMEJBQVcsRUFBRSxDQUFBO1FBRTdCLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQTtRQUUvQyxJQUFJLENBQUMsbUJBQW1CLEdBQUc7WUFDdkIsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxFQUFFLEVBQUU7WUFDN0IsRUFBRSxJQUFJLEVBQUUsa0JBQWtCLEVBQUUsT0FBTyxFQUFFLEVBQUUsRUFBRTtZQUN6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OzRCQUNYLE1BQU0sRUFBQyxNQUFNLENBQUMsS0FBSSxDQUFDLE1BQU0sQ0FBQzs0QkFDMUIsRUFBRSxFQUFDLE1BQU0sQ0FBQyxLQUFJLENBQUMsV0FBVyxDQUFDO3lCQUk5Qjt3QkFDQyxZQUFZLEVBQUUsSUFBSTtxQkFDbkIsQ0FDRixDQUFDO2lCQUNMO3FCQUNHO29CQUNFLEtBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsQ0FBQyxNQUFNLENBQUMsRUFBRTt3QkFFdkMsVUFBVSxFQUFFOzRCQUNWLElBQUksRUFBRSxNQUFNO3lCQUNiO3dCQUNELFdBQVcsRUFBRTs0QkFDWCxNQUFNLEVBQUMsTUFBTSxDQUFDLEtBQUksQ0FBQyxNQUFNLENBQUM7NEJBQzFCLEVBQUUsRUFBQyxNQUFNLENBQUMsS0FBSSxDQUFDLFdBQVcsQ0FBQzt5QkFJOUI7d0JBQ0MsWUFBWSxFQUFFLElBQUk7cUJBQ25CLENBQ0YsQ0FBQztpQkFDTDthQUNOO2lCQUVEO2dCQUNFLEtBQUssQ0FBQyxTQUFTLEdBQUMsSUFBSSxHQUFFLEdBQUcsR0FBTyxHQUFJLENBQUMsS0FBSyxDQUFDLENBQUE7YUFDNUM7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUVYLENBQUM7SUE3SVEscUJBQXFCO1FBTmpDLGdCQUFTLENBQUM7WUFDUCxRQUFRLEVBQUUsY0FBYztZQUN4QixRQUFRLEVBQUUsTUFBTSxDQUFDLEVBQUU7WUFDbkIsV0FBVyxFQUFFLCtCQUErQjtZQUM1QyxTQUFTLEVBQUUsQ0FBQyw0Q0FBcUIsQ0FBQztTQUNyQyxDQUFDO3lDQWNpQyw4QkFBZ0IsRUFBNEIseUJBQWdCO1lBQzFFLHVCQUFjLEVBQXdCLDRDQUFxQjtPQWRuRSxxQkFBcUIsQ0ErSWpDO0lBQUQsNEJBQUM7Q0FBQSxBQS9JRCxJQStJQztBQS9JWSxzREFBcUIiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiogQGF1dGhvciBCYXp6aXRlIChodHRwczovL3d3dy5iYXp6aXRlLmNvbSlcbiogQGxpY2Vuc2UgTUlUIExpY2Vuc2UgQ29weXJpZ2h0IChjKSAyMDE4IEJhenppdGVcbiovXG5cbmltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0IH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcblxuaW1wb3J0IHsgRGF0YVNlcnZpY2UgfSBmcm9tIFwiLi4vc2hhcmVkL2RhdGEuc2VydmljZVwiO1xuaW1wb3J0IHsgVHJhbnNsYXRlU2VydmljZSwgTGFuZ0NoYW5nZUV2ZW50IH0gZnJvbSAnLi4vQG5neC10cmFuc2xhdGUvY29yZUAxMC4wLjInO1xuaW1wb3J0IHsgcmVxdWVzdCwgZ2V0RmlsZSwgZ2V0SW1hZ2UsIGdldEpTT04sIGdldFN0cmluZyB9IGZyb20gXCJ0bnMtY29yZS1tb2R1bGVzL2h0dHBcIjtcbmltcG9ydCB7IE5hdmlnYXRpb25FbmQsTmF2aWdhdGlvbkV4dHJhcyAsQWN0aXZhdGVkUm91dGV9IGZyb20gXCJAYW5ndWxhci9yb3V0ZXJcIjtcbmltcG9ydCB7IFJvdXRlckV4dGVuc2lvbnMgfSBmcm9tIFwibmF0aXZlc2NyaXB0LWFuZ3VsYXIvcm91dGVyXCI7XG5pbXBvcnQgeyBNeXJlZ2lzdGVyUG9zdFNlcnZpY2UgfSBmcm9tIFwiLi9jb25maXJtYXRpb24uc2VydmljZVwiO1xuXG5pbXBvcnQgeyBTZWN1cmVTdG9yYWdlIH0gZnJvbSBcIm5hdGl2ZXNjcmlwdC1zZWN1cmUtc3RvcmFnZVwiO1xuaW1wb3J0ICogYXMgcGxhdGZvcm1Nb2R1bGUgZnJvbSBcInRucy1jb3JlLW1vZHVsZXMvcGxhdGZvcm1cIjtcbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiBcIkNvbmZpcm1hdGlvblwiLFxuICAgIG1vZHVsZUlkOiBtb2R1bGUuaWQsXG4gICAgdGVtcGxhdGVVcmw6IFwiLi9jb25maXJtYXRpb24uY29tcG9uZW50Lmh0bWxcIixcbiAgICBwcm92aWRlcnM6IFtNeXJlZ2lzdGVyUG9zdFNlcnZpY2VdXG59KVxuZXhwb3J0IGNsYXNzIENvbmZpcm1hdGlvbkNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gICAgXG4gICAgXG4gICAgZGF0YTogRGF0YVNlcnZpY2U7XG4gICAgdHJhbnNhY3Rpb25zID0gW11cbiAgICBleHBlbnNlc0NoYXJ0RGF0YUVuID0gW107XG4gICAgZXhwZW5zZXNDaGFydERhdGFFcyA9IFtdO1xuICAgIHB1YmxpYyBpbmRleDogbnVtYmVyO1xuICAgIHB1YmxpYyBudW1iZXI6c3RyaW5nXG4gICAgcHVibGljIGNvdW50cnlDb2RlOnN0cmluZ1xuICAgIHB1YmxpYyBjdXJyZW50TGFuZ3VhZ2UgPSAnZW4nO1xuXG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHRyYW5zbGF0ZTogVHJhbnNsYXRlU2VydmljZSwgcHJpdmF0ZSByb3V0ZXJFeHRlbnNpb25zOiBSb3V0ZXJFeHRlbnNpb25zLFxuICAgICAgcHVibGljIGFjUm91dGU6QWN0aXZhdGVkUm91dGUscHJpdmF0ZSBteVBvc3RTZXJ2aWNlOiBNeXJlZ2lzdGVyUG9zdFNlcnZpY2UpIHtcbiAgICAgICAgdGhpcy5kYXRhID0gbmV3IERhdGFTZXJ2aWNlKClcblxuICAgICAgICB0aGlzLnRyYW5zYWN0aW9ucyA9IHRoaXMuZGF0YS5nZXRUcmFuc2FjdGlvbnMoKVxuXG4gICAgICAgIHRoaXMuZXhwZW5zZXNDaGFydERhdGFFbiA9IFtcbiAgICAgICAgICAgIHsgbmFtZTogXCJIb21lXCIsIGFtbW91bnQ6IDkwIH0sXG4gICAgICAgICAgICB7IG5hbWU6IFwiQXV0byAmIFRyYW5zcG9ydFwiLCBhbW1vdW50OiA3NiB9LFxuICAgICAgICAgICAgeyBuYW1lOiBcIkNvbW11bmljYXRpb25cIiwgYW1tb3VudDogNjAgfSxcbiAgICAgICAgICAgIHsgbmFtZTogXCJIb3RlbFwiLCBhbW1vdW50OiA0NCB9XG4gICAgICAgIF1cblxuICAgICAgICB0aGlzLmV4cGVuc2VzQ2hhcnREYXRhRXMgPSBbXG4gICAgICAgICAgICB7IG5hbWU6IFwiSG9nYXJcIiwgYW1tb3VudDogMjAgfSxcbiAgICAgICAgICAgIHsgbmFtZTogXCJUcmFuc3BvcnRlXCIsIGFtbW91bnQ6IDc2IH0sXG4gICAgICAgICAgICB7IG5hbWU6IFwiQ29tdW5pY2FjacOzblwiLCBhbW1vdW50OiA2MCB9LFxuICAgICAgICAgICAgeyBuYW1lOiBcIkhvdGVsXCIsIGFtbW91bnQ6IDQ0IH1cbiAgICAgICAgXVxuXG4gICAgICAgIHRyYW5zbGF0ZS5vbkxhbmdDaGFuZ2Uuc3Vic2NyaWJlKChldmVudDogTGFuZ0NoYW5nZUV2ZW50KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRMYW5ndWFnZSA9IGV2ZW50Lmxhbmc7XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICB9XG4gICAgcHVibGljIGNvdW50cnk6YW55W109W11cbiAgIC8vIHB1YmxpYyBudW1iZXI9XCJcIlxuICAgIHB1YmxpYyBjYz1cIlwiO1xuICAgIHB1YmxpYyBpbnB1dD1cIlwiO1xuICAgIHB1YmxpYyB2ZXJpZnlUZXh0PVwiUGxlYXNlIFZlcmlmeSB0aGUgbnVtYmVyICtcIlxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xuICAgICAgICBcbiAgICAgICAgdGhpcy5hY1JvdXRlLnF1ZXJ5UGFyYW1zLnN1YnNjcmliZShwYXJhbXMgPT4ge1xuXG4gICAgICAgICAgXG4gICAgICAgICAgICBpZihwYXJhbXNbXCJudW1iZXJcIl0pe1xuICAgICAgICAgICAgdGhpcy52ZXJpZnlUZXh0PXRoaXMudmVyaWZ5VGV4dCtTdHJpbmcocGFyYW1zW1wiY2NcIl0pK1N0cmluZyhwYXJhbXNbXCJudW1iZXJcIl0pXG4gICAgICAgICAgICAgICAgdGhpcy5udW1iZXI9cGFyYW1zWydudW1iZXInXVxuICAgICAgICAgICAgICAgIHRoaXMuY2M9cGFyYW1zWydjYyddXG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICB9KVxuICAgICAgICBcbiAgICB9XG4gICAgb25UYXAoZSl7XG4gICAgICAgIGxldCBjYz1TdHJpbmcodGhpcy5jYylcbiAgICAgICAgICBsZXQgcG49U3RyaW5nKHRoaXMubnVtYmVyKVxuICAgICAgICAgIGxldCB1ZGlkPXBsYXRmb3JtTW9kdWxlLmRldmljZS51dWlkXG4gICAgICAgICAgLy85MDBDNkQ0NzM3QjlGN0Q1XG4gICAgICAgICAgXG4gICAgICAgICAgICAgICAgbGV0IGRhdGE9XCJ1ZGlkPVwiK3VkaWQrXCImY2M9XCIrY2MrXCImb3M9SU9TJmFwcF9pZD0xJnBuPVwiK3BuK1wiJmNvZGU9XCIrU3RyaW5nKHRoaXMuaW5wdXQpXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKVxuICAgICAgICAgICAgdGhpcy5teVBvc3RTZXJ2aWNlXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC5wb3N0RGF0YShkYXRhKVxuICAgICAgICAgICAgLnN1YnNjcmliZShyZXMgPT4ge1xuICAgICAgICAgICAgICAvLyAgdGhpcy5tZXNzYWdlID0gKDxhbnk+cmVzKS5qc29uLmRhdGEudXNlcm5hbWU7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlcylcbiAgICAgICAgICAgICAgbGV0IGNvZGU9KDxhbnk+cmVzKS5jb2RlXG4gICAgICAgICAgICAgIGlmKGNvZGU9PTIwNCl7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgbGV0IHNlY3VyZVN0b3JhZ2UgPSBuZXcgU2VjdXJlU3RvcmFnZSgpO1xuICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IHNlY3VyZVN0b3JhZ2UuZ2V0U3luYyh7XG4gICAgICAgICAgICAgICAgICBrZXk6IFwic2lwX3VzZXJcIlxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmKCF2YWx1ZSl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkYXRhPSg8YW55PnJlcykuZGF0YVxuICAgICAgICAgICAgICAgICAgICAgICAgICBzZWN1cmVTdG9yYWdlLnNldCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5OiBcInNpcF91c2VyXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGRhdGEudXNlclxuICAgICAgICAgICAgICAgICAgICAgICAgICB9KS50aGVuKHN1Y2Nlc3MgPT4gY29uc29sZS5sb2coXCJTYXZlZCBVc2VyXCIgKyBzdWNjZXNzKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgc2VjdXJlU3RvcmFnZS5zZXQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleTogXCJzaXBfcGFzc3dvcmRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogZGF0YS5wYXNzd29yZFxuICAgICAgICAgICAgICAgICAgICAgICAgICB9KS50aGVuKHN1Y2Nlc3MgPT4gY29uc29sZS5sb2coXCJTYXZlZCBwYXNzd29yZFwiICsgc3VjY2VzcykpXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHNlY3VyZVN0b3JhZ2Uuc2V0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXk6IFwic2lwX3Byb3h5XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGRhdGEucHJveHlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSkudGhlbihzdWNjZXNzID0+IGNvbnNvbGUubG9nKFwiU2F2ZWQgcHJveHlcIiArIHN1Y2Nlc3MpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICBzZWN1cmVTdG9yYWdlLnNldCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5OiBcInNpcF90cmFuc3BvcnRcIiwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGRhdGEudHJhbnNwb3J0XG4gICAgICAgICAgICAgICAgICAgICAgICAgIH0pLnRoZW4oc3VjY2VzcyA9PiBjb25zb2xlLmxvZyhcIlNhdmVkIHRyYW5zcG9ydFwiICsgc3VjY2VzcykpXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHNlY3VyZVN0b3JhZ2Uuc2V0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXk6IFwic2lwX3BvcnRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogZGF0YS5wb3J0XG4gICAgICAgICAgICAgICAgICAgICAgICAgIH0pLnRoZW4oc3VjY2VzcyA9PiBjb25zb2xlLmxvZyhcIlNhdmVkIHBhc3N3b3JkXCIgKyBzdWNjZXNzKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucm91dGVyRXh0ZW5zaW9ucy5uYXZpZ2F0ZShbJ2hvbWUnXSwge1xuICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zaXRpb246IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiZmFkZVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWVyeVBhcmFtczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVtYmVyOlN0cmluZyh0aGlzLm51bWJlciksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYzpTdHJpbmcodGhpcy5jb3VudHJ5Q29kZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhckhpc3Rvcnk6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSBcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yb3V0ZXJFeHRlbnNpb25zLm5hdmlnYXRlKFsnaG9tZSddLCB7XG4gICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJmYWRlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5UGFyYW1zOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1iZXI6U3RyaW5nKHRoaXMubnVtYmVyKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNjOlN0cmluZyh0aGlzLmNvdW50cnlDb2RlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFySGlzdG9yeTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICB9IFxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGFsZXJ0KFwiZXJyb3I6IFwiK2NvZGUrIFwiIFwiKyg8YW55PnJlcykuZXJyb3IpXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIFxuICAgIH1cbiAgICBcbn1cbiJdfQ==